## 1. Социальная сеть Mastodon

## 2. Платформа Luwrain

### 2.1 Основная информация

Luwrain - это платформа для построения невизуальных интерфейсов для слепых и слабовидящих людей с открытым исходным кодом.

Особенностью и отличительной чертой данной платформы является нативный невизуальный интерфейс. Компоненты платформы позволяют создать эффективно взаимодействовать с компьютером и обрабатывать ситуации, когда невозможно получить информацию с экрана в невизуальной форме. Это позволяет создать единый подход к работе над задачами любого рода, а следовательно выработать ряд привычек, которые помогают определить порядок действий в той или иной ситуации без необходимости прибегать к документации.

В основе данного похода лежит идея невизуального дизайна. Она заключается в том, чтобы как можно сильнее снизить издержки взаимодействия пользователя с системой. Это достигается наличием текстового представления у каждого элемента интерфейса, которое отображается на экране (эта возможность сохранена для слабовидящих пользователей). Текстовая информация, в свою очередь, воспроизводится в виде звука при помощи синтезатора речи. Эта функция поддерживается повсеместно. При этом, есть два режима воспроизведения:
1. Воспроизведение при интерактивном взаимодействии;
   Данное режим представляет из себя более точное воспроизведение текста и подходит для навигации. 
2. Воспроизведение для прослушивания.
   Данный режим приближен к естественной речи и подходит для прослушивания текстов и книг.

### 2.2 Расширения

Платформа спроектирована таким образом, что использование ее компонент не вызывает затруднений и позволяет любому пользователю легко создать собственное приложение с необходимой ему функциональностью. Это возможно при помощи так называемых "расширений". Фактически, расширение представляет из себя реализацию интерфейса `org.luwrain.core.Extension` или `org.luwrain.core.EmptyExtension`, который создан для удобства и позволяет добавить только необходимые функции.
Расширения бывают двух типов:
1. Расширения, скомпилированные в виде jar файла;
   Большая часть расширений написана на Java, в данной работе реализация будет написана на Kotlin, так же, предполагается возможность написания расширений на Scala и Groovy, однако это не проверялось.
2. Расширения, написанные на JavaScript.
Так же, расширения делятся на две категории:
1. Системные;
   Доверенные расширения из состава дистрибутива.
2. Пользовательские.
   Так как пользовательские расширения могут быть получены из непроверенных источников для них в системе присутствуют механизмы ограничений.

При загрузке платформа LUWRAIN самостоятельно создаст экземпляр класса расширения и запросит необходимое множество объектов для интеграции.
В дистрибутивах LUWRAIN присутствуют два каталога расширений: jar и lib. При запуске системы содержимое этих каталогов сканируется и все файлы с расширением .jar. Подразумевается, что в каталоге `jar` находятся файлы, которые собраны из исходных текстов проекта, а в `lib` присутствуют сторонние библиотеки, полученные от других разработчиков в виде бинарных файлов.

При обработке каждого файла с расширением `.jar` проверяется наличие секции `org/luwrain` в его манифесте. Если в этой секции есть значение `Extensions`, то предполагается, что оно содержит список классов, удовлетворяющих интерфейсу `org.luwrain.core.Extension`, каждый из которых воспринимается как класс расширения для загрузки. Если такое значение в манифесте отсутствует, то файл загружается просто как вспомогательная библиотека, классы которой будут доступны другим библиотекам.

Обратите внимание, что порядок членов манифеста в таких системах сборки как Apache Maven и Gradle может отличаться от указанного выше. Это обусловлено тем, что в их реализации используется HashMap, а не LinkedHashMap, что может нарушать необходимый порядок и ваше расширение распознается некорректно и будет загружено, как библиотека. Если вы столкнулись с такой проблемой, то одним из ее решений может использование системы сборки Ant.
https://discuss.gradle.org/t/order-of-manifest-attributes-is-no-longer-preserved/18168

В файле конфигурации сборки Ant, build.xml, необходимо указать следующие параметры в target, который собирает jar файл:
```xml
<jar jarfile="jar/your-app.jar">
	<manifest>
		<section name="org/luwrain">
			<attribute name="Extensions" value="path.to.Extension"/>
		</section>
	</manifest>
    ...
</jar>
```

### 2.3 Получение дистрибутива

#### 2.3.1. Виды дистрибутивов

На текущий момент поддерживается несколько дистрибутивов:
1. Приложение для Microsoft Windows;
2. Приложение для GNU/Linux;
3. Приложение для Raspberry Pi;
4. В виде ISO образа операционной системы на базе ядра Linux. 
#### 2.3.2. Получение дистрибутива

Выделяется два основных метода получения дистрибутива данной платформы:
1. В виде собранного пакета с официального сайта 
2. Из исходных текстов
##### 2.3.2.1. Получение с официального сайта

Для этого необходимо перейти по ссылке: https://luwrain.org/download/?lang=ru&mode=normal
На странице доступно несколько разделов для загрузки необходимого дистрибутива.
##### 2.3.2.2. Получение из исходных текстов и сборка

Исходный текст можно найти по ссылке: https://github.com/luwrain/parent
Для того, чтобы загрузить исходные тексты на свой компьютер, необходимо выполнить команду: 
```sh
git clone --recursive https://github.com/luwrain/parent.git
```
Обратите внимание, так как проект разделен на несколько репозиториев, необходимо указать флаг `--recursive`, чтобы заргузить код из дочерних репозиториев. Так же, предполагается, что в вашей системе доступна команда git (для дистрибутивов Linux доступна по умолчанию, для Windows придется произвести загрузку из интернета).

Для того, чтобы собрать проект, необходимо, чтобы в вашей системе были установлены:
1. JRE версии 17 SE и выше;
2. Система сборки Apache Maven;
3. Система сборки Apache Ant.

Для сборки необходимо выполнить следующие команды:
```sh
cd parent/base/scripts
./lwr-ant-gen-all
./lwr-build
```

Так же, для ускорения сборки, можно отключить тестирование и генерацию документации. Для этого в той же директории в файле `lwr-build-mvn`, в строке `mvn install -B -C -q` можно добавить флаги `-DskipTests=true` и `-Dmaven.javadoc.skip=true`, а так же закоментировать строку `mv jar/*javadoc*.jar javadoc`

### 2.4. Разработка

Для разработки рекомендуется скачать дистрибутив с официального сайта и исходные тексты платформы. Наличие исходных текстов позволит, при необходимости, оперативно найти места, которые могут вызывать затруднения и, зачастую, быстро найти решение.

Перед, непосредственно, разработкой, необходимо создать модуль приложения и подключить его к parent. Для этого необходимо:
1. Создать директорию вашего приложения в parent с префиксом `app-`, например, `app-mastodon`
2. Добавить `pom.xml` в получившуюся в п.1 директорию
3. В `parent/pom.xml`, в теге `<modules>` добавить модуль приложения
```xml
<modules>
	...
	<module>app-mastodon</module>
</modules>
```

Для использования компонент Luwrain в вашем приложении, необходимо в `pom.xml` вашего приложения добавить зависимость:
```xml
<dependencies>
	...
	<dependency>
		<groupId>org.luwrain</groupId>
		<artifactId>luwrain</artifactId>
		<version>${luwrain.version}</version>
	</dependency>
</dependencies>
```
Так как в данный момент API Luwrain нестабилен и он намеренно не загружается в основной репозиторий Maven, необходимо так же подключить репозиторий Luwrain:
```xml
<repositories>
	...
	<repository>
		<id>luwrain</id>
		<name>luwrain</name>
		<url>https://download.luwrain.org/maven2/</url>
	</repository>
</repositories>
```

При сборке необходимо добавить название вашего приложения в `parent/base/scripts/config.sh` в переменную `APPS` через пробел, без префикса `app-`:
```sh
...
APPS='commander contacts main news notepad telegram viewer vk mastodon'
...
```

В процессе разработки, после компиляции приложения, его необходимо поместить в директорию `lib` скачанного дистрибутива. 
Удобно использовать символьные ссылки, что бы экономить время на копировании `jar` файлов:
```sh
cd lib
ln -sf /path/to/app-mastodon.jar app-mastodon.jar
```
Флаг `-s` создаст символьную ссылку, а `-f` перезапишет ее, если она существовала.

Так как весь код платформы на данный момент написан на языке Java, то необходимо внести следующие изменения в файл сборки Apache Ant. Он генерируется автоматически скриптом parent/base/scripts/lwr-ant-gen-app. После генерации этого файла
1. Необходимо скачать `kotlin-ant.jar` по ссылке https://github.com/JetBrains/kotlin/releases/tag/v1.9.24
2. В файле `build.xml` вашего приложения добавить плагин Ant:
```xml
<typedef 
	resource="org/jetbrains/kotlin/ant/antlib.xml"
	classpath="/path/to/kotlin-ant.jar"
/>
```
3. В `compile` к телу команды `javac` добавить тег `<withKotlin/>`, чтобы он лежал после тегов `<compilerarg .../>`
4. Так как исходный код Kotlin обычно располагается отдельно от Java, нужно добавить его на вход компилятора. Для этого нужно поменять параметр `srcdir` в  `compile` с `src/main/java` на `src/main`, так как директории `java` и `kotlin` лежат в одном месте